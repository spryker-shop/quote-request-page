{% extends template('page-layout-customer', 'CustomerPage') %}

{% define data = {
    title: 'quote_request_page.quote_request' | trans,
    quoteRequestForm: _view.quoteRequestForm,
    quoteRequest: _view.quoteRequestForm.vars.value,
} %}

{% set quote = data.quoteRequest.latestVersion.quote %}

{% block breadcrumbs %}
    {% include molecule('breadcrumb') with {
        data: {
            steps: [
                {
                    label: 'customer.account' | trans,
                    url: path('customer/overview'),
                },
                {
                    label: 'quote_request_page.quote_request' | trans,
                    url: path('quote-request')
                },
                {
                    label: 'quote_request_page.quote_request.actions.edit' | trans,
                }
            ]
        }
    } only %}
{% endblock %}

{% block content %}

    {% if not quote or quote.items is empty %}
        <div class="box text-center">
            {% include atom('icon') with {
                modifiers: ['biggest'],
                class: 'text-alt',
                data: {
                    name: 'shopping-cart'
                }
            } only %}
            <h6>{{ 'cart.empty' | trans }}</h6>
        </div>
    {% else %}

        {{ form_start(data.quoteRequestForm) }}

        <div class="grid">
            <div class="col col--sm-12 col--xl-8">
                <div class="box">
                    {% for child in data.quoteRequestForm.latestVersion.metadata %}
                        <div class="col col--sm-12 col--xl-6">
                            <div class="box">
                                {{ form_row(child) }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="col col--sm-12 col--xl-4">
                <div class="box">
                    <h6>{{ "quote_request_page.quote_request.labels.information" | trans }}</h6>
                    <hr>
                    <p>{{ 'quote_request_page.quote_request.labels.date' | trans }}:
                        <b>{{ data.quoteRequest.createdAt | date('d.m.Y H:i') }}</b>
                    </p>
                    <p>{{ 'quote_request_page.quote_request.labels.status' | trans }}:
                        <span class="request-status request-status--{{ data.quoteRequest.status }}">{{ ('quote_request.status.' ~ data.quoteRequest.status) | trans }}</span>
                    </p>
                    <p>{{ 'quote_request_page.quote_request.labels.valid_till' | trans }}:
                        <b>{{ data.quoteRequest.validUntil ? (data.quoteRequest.validUntil | date('d.m.Y H:i')) : '' }}</b>
                    </p>
                    <hr>
                    <h6>{{ "quote_request_page.quote_request.labels.version_information" | trans }}</h6>
                    <hr>
                    <p>{{ 'quote_request_page.quote_request.labels.history' | trans }}:
                        <b>{{ data.quoteRequest.latestVersion ? data.quoteRequest.latestVersion.versionReference : null }}</b>
                    </p>
                </div>
            </div>
        </div>
        <div class="grid">
            <div class="col col--sm-12 col--xl-8">
                {% if quote and quote.priceMode is not empty %}
                    <div class="box">
                        {% include molecule('price-mode') with {
                            data: {
                                priceMode: quote.priceMode
                            }
                        } only %}
                    </div>
                {% endif %}
                {% for cartItem in quote.items %}
                    {% include molecule('quote-request-cart-item', 'CartPage') with {
                        class: 'box',
                        data: {
                            priceMode: quote.priceMode,
                            cartItem: cartItem,
                            currency: quote.currency,
                        }
                    } only %}
                {% endfor %}
            </div>

            <div class="col col--sm-12 col--xl-4">
                <div class="box">
                    {% include molecule('quote-request-cart-summary', 'CartPage') with {
                        data: {
                            cart: quote
                        }
                    } only %}
                </div>
                <div class="box">
                    <a class="button button--expand button--hollow"
                       href="{{ url('quote-request/details', {quoteRequestReference: data.quoteRequest.quoteRequestReference}) }}">
                        {{ 'quote_request_page.quote_request.actions.back_to_view' | trans }}
                    </a>
                    <hr/>
                    <a class="button button--expand button--edit-items"
                       href="{{ url('quote-request/edit-items', { quoteRequestReference: (data.quoteRequest.quoteRequestReference) }) }}">
                        {{ 'quote_request_page.quote_request.actions.edit_items' | trans }}
                    </a>
                    <hr/>
                    <button type="submit" name="save" class="button button--expand button--success">
                        {{ 'quote_request_page.quote_request.actions.save' | trans }}
                    </button>
                    <hr/>
                    <button type="submit" name="sendToUser" class="button button--expand button--success">
                        {{ 'quote_request_page.quote_request.actions.send_to_agent' | trans }}
                    </button>
                </div>
            </div>
        </div>

        {{ form_end(data.quoteRequestForm) }}

    {% endif %}
{% endblock %}
